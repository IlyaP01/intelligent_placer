# Intelligent Placer
Большая лабораторная работа по курсу "Решение задач с семантическим разрывом", СПбПУ, 2022г.

Павлов Илья, гр. 5030102/90201.

# Постановка задачи
Требуется по поданной на вход фотографии нескольких предметов на светлой горизонтальной поверхности и нарисованному многоугольнику понимать, можно ли расположить одновременно все эти предметы на плоскости так, чтобы они влезли в этот многоугольник. Предметы и горизонтальная поверхность, которые могут оказаться на фотографии, заранее известны.

`Intelligent Placer` представляет собой python-библиотеку 
`intelligent_placer_lib`, которая поставляется каталогом `intelligent_placer_lib` 
с файлом `intelligent_placer.py`, содержащим функцию - точку входа
`check_image(path_to_jpg_image)`
которая возвращает True если предметы могут влезть в многоугольник, иначе False.

## Ограничения
### Общие требования к изображениям
* Изображения должны быть в формате jpeg
* Съёмка должная вестить вертикально, допустимое отклонение не более 10 градусов
* Объёкты на изображениях должны быть чёткими, хорошо освещёнными, без сильных бликов и теней
### Содержание изображений
* Предметы и многоугольник должны быть размещены на ровной белой поверхности
* Допускаются только 10 заранее определённых предметов (см. Data/objects)
* Многоульник должен быть нарисован на белом листе бумаги чёрным маркером или тёмно-синий ручкой с достаточно толстой линией.
* Размер листа и его положение не имеют значения
* Предметы не должны пересекаться между собой и с мноугольником
* Предметы должны быть расположены вне многоугльника (могут располагаться в том числе на листе бумаги)

# План решения
Решение задачи можно разбить на два этапа: поиск объектов на изображении и их размещение.
### Поиск объектов
Первоначальные тесты показывают, что при выполнении требований (равномерная освещённость, объекты не смазаны), предметы хорошо сегментируется многими алгоритмами бинаризации (Otsu, Li, Yen, Isodata). При этом детекторы границ (например Canny) хорошо выделяют контур многоугольника, но плохо работают для предметов (выделаются лишние конутры на предметах и контуры от теней)
* Предлагается использовать метод Оцу для бинаризации и морфологические операции для удаления лишних фрагментов (в том числе фрагментов тонкого конутра многоугольника).
* Для поиска контура многоугольника лучше использовать детектор границ Canny.
* Контуром многоугольника является тот, у которого среднее значение интенсивности внутренней области наибольшее. 
### Размещение
* Удобно работать с аппроксимацией контуров объектов в виде выпуклых многоугольников. 
* Можно попробовать рассмотреть задачу как bin packing problem (задача оптимального размещения произваольных выпуклых многоугольников в полосе фиксированной ширины так, чтобы суммарная длина была минимальна), для которой существет много эвристических алгоритмов (обзор приведён, например, в [здесь](https://www.uv.es/marsyan/docs/thesis.pdf)). Также доступны готовые реализации на C++ и Python (https://github.com/tamasmeszaros/libnest2d, https://github.com/markfink/nest2D). 
* Можно брать n, n-1, n-2, ... наибольших по площади предметов, и решать для них задачу упаковки. В качестве ширины полосы можно перебирать длины сторон многоугольника, пока полученный описывающий прямоугольник не будет помещаться в многоугольнике. Если подходящих прямоугольников несколько, брать наименьший по площади.
* Оставшиеся 0, 1, 2, ... наименьших предметов можно размещать в оставшейся свободной области по жадному алгоритму с перебором дискретных значений углов поворотов и сдвигов.